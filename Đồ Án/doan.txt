CREATE DATABASE QLBH_BANQUANAO
--ON PRIMARY(
--	NAME = BANQUANAO,
--	FILENAME ='D:\database\banquanao1.mdf',
--	SIZE = 4 MB,
--	MAXSIZE = 10 MB,
--	FILEGROWTH = 5%
--)
--LOG ON (
--	NAME = BANQUANAO_log,
--	FILENAME = 'D:\database\banquanao_log1.ldf',
--	SIZE = 1 MB,
--	MAXSIZE = UNLIMITED,
--	FILEGROWTH = 5%
--)

USE QLBH_BANQUANAO

CREATE TABLE NHANVIEN(
	ANH VARCHAR(50),
	MANV CHAR(5) PRIMARY KEY,
	TEN NVARCHAR(MAX),
	NGSINH DATETIME,
	DCHI NVARCHAR(MAX),
	NGVAOLAM DATETIME,
	SDT VARCHAR(11),
	GIOITINH NVARCHAR(3),
	LUONG MONEY,
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE SANPHAM(
	ANH VARCHAR(50),
	MASP CHAR(10) PRIMARY KEY,
	MALOAI CHAR(3),
	MANCC CHAR(5) NOT NULL,
	TENSP NVARCHAR(50),
	MOTA NVARCHAR(50),
	DONVITINH NVARCHAR (20),
	SOLUONG INT,
	GIANHAP INT,
	GIABANLE INT,
	GIADANGBAI INT,
	GIASI1	INT,
	GIASI2	INT,
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE LOAISP(
	MALOAI CHAR(3) PRIMARY KEY,
	TENLOAISP NVARCHAR(20),
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE SIZE(
	MASIZE CHAR(3) PRIMARY KEY,
	TENSIZE VARCHAR(5),
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE MAU(
	MAMAU CHAR(3) PRIMARY KEY,
	TENMAU NVARCHAR(20),
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE CT_SANPHAM(
	MACTSP NVARCHAR(50) UNIQUE,
	MASP CHAR(10),
	MASIZE CHAR(3),
	MAMAU CHAR(3),
	GHICHU NVARCHAR(MAX),
	GIABAN MONEY,
	SOLUONG INT,
	ANH VARCHAR(50),
	TRANGTHAI INT DEFAULT (0)
	PRIMARY KEY(MASP, MASIZE, MAMAU)
)

CREATE TABLE NHACUNGCAP(
	MANCC CHAR(5) PRIMARY KEY,
	TENNCC NVARCHAR(50),
	SDT NVARCHAR(50),
	TAIKHOAN NVARCHAR(50),
	TENNH VARCHAR(24),
	LINK VARCHAR(MAX),
	DCMAIL VARCHAR(50),
        LOAISP CHAR(3) NOT NULL,
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE KHACHHANG (
	MAKH CHAR(5) PRIMARY KEY,
	TENKH NVARCHAR(50),
	NGSINH DATETIME,
	DCHI NVARCHAR(50),
	PHONE VARCHAR(24),
	DCMAIL VARCHAR(50),
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE CT_HOADONBAN(
	MAHD CHAR(5) NOT NULL,
	MASP CHAR(10) NOT NULL,
	MACTSP NVARCHAR(50) UNIQUE,
	SOLUONG INT,
	DONGIA MONEY,
	ANH VARCHAR(50),
	TRANGTHAI INT DEFAULT(0),
	PRIMARY KEY(MAHD, MASP)
)

CREATE TABLE CT_HOADONNHAP(
	MAHD CHAR(5) NOT NULL,
	MASP CHAR(10) NOT NULL,
	MANCC CHAR(5) NOT NULL,
	MACTSP NVARCHAR(50) UNIQUE,
	SOLUONG INT,
	DONGIA INT,
	TRANGTHAI INT DEFAULT(0),
	PRIMARY KEY(MAHD, MASP)
)

CREATE TABLE HOADONNHAP(
	MAHD CHAR(5) PRIMARY KEY,
	MANV CHAR(5) NOT NULL,
	MASP CHAR(10) NOT NULL,
	NGAYLAPHD DATETIME DEFAULT(GETDATE()),
	SOLUONG INT,
	DONGIA MONEY,
	THANHTIEN MONEY,
	CHIETKHAU MONEY,
	TRANGTHAI INT DEFAULT(0)
)

CREATE TABLE HOADONBAN(
	MAHD CHAR(5) PRIMARY KEY,
	MANV CHAR(5) NOT NULL,
	MASP CHAR(10) NOT NULL,
	MAKH CHAR(5) NOT NULL,
	NGAYLAPHD DATETIME DEFAULT(GETDATE()),
	SOLUONG INT,
	DONGIA MONEY,
	THANHTIEN MONEY,
	CHIETKHAU MONEY,
	TRANGTHAI INT DEFAULT(0)
)

ALTER TABLE SANPHAM
ADD FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)

ALTER TABLE SANPHAM
ADD FOREIGN KEY (MALOAI) REFERENCES LOAISP(MALOAI)

ALTER TABLE HOADONBAN
ADD FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)

ALTER TABLE HOADONNHAP
ADD FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE HOADONBAN
ADD FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE CT_HOADONNHAP
ADD FOREIGN KEY (MAHD) REFERENCES HOADONNHAP(MAHD)

ALTER TABLE CT_HOADONNHAP
ADD FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP)

ALTER TABLE CT_HOADONNHAP
ADD FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC)

ALTER TABLE CT_HOADONNHAP
ADD FOREIGN KEY (MACTSP) REFERENCES CT_SANPHAM(MACTSP)

ALTER TABLE CT_HOADONBAN
ADD FOREIGN KEY (MAHD) REFERENCES HOADONBAN(MAHD)

ALTER TABLE CT_HOADONBAN
ADD FOREIGN KEY (MACTSP) REFERENCES CT_SANPHAM(MACTSP)

ALTER TABLE CT_HOADONBAN
ADD FOREIGN KEY (MACTSP) REFERENCES CT_SANPHAM(MACTSP)

ALTER TABLE CT_SANPHAM
ADD FOREIGN KEY (MASIZE) REFERENCES SIZE(MASIZE)

ALTER TABLE CT_SANPHAM
ADD FOREIGN KEY (MAMAU) REFERENCES MAU(MAMAU)

ALTER TABLE NHACUNGCAP
ADD FOREIGN KEY (LOAISP) REFERENCES LOAISP(MALOAI)

